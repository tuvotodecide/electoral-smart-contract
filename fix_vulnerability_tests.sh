#!/bin/bash

# Script para corregir autom√°ticamente los tests de vulnerabilidad
# Aplica ensureOracleActive() a tests que lo necesitan

echo "üîß Aplicando correcciones a tests de vulnerabilidad..."

TESTS_FILE="/home/ronaldo/development/Asoblockchain/TrabajoAsoblock-Agosto/semana-1-Ago/git-system-merge/electoral-smart-contract/test/security/VulnerabilityTests.t.sol"

# Lista de tests que necesitan or√°culo activo
TESTS_TO_FIX=(
    "test_HeavyAttack_09_ReentrancyRewardAttack"
    "test_HeavyAttack_12_OracleManipulationAttack" 
    "test_HeavyAttack_13_ConsensusBreakingAttack"
    "test_CriticalAttack_16_ElectoralFraudSimulation"
    "test_CriticalAttack_18_SmartContractDestruction"
    "test_CriticalAttack_19_DataIntegrityCompromise"
    "test_CriticalAttack_20_CompleteNetworkDenial"
    "test_SoftAttack_03_DuplicateAttestations"
    "test_SoftAttack_06_GasExhaustionLoops"
    "test_SoftAttack_07_TransactionFrontrunning"
)

# Backup original
cp "$TESTS_FILE" "${TESTS_FILE}.backup"

echo "‚úÖ Backup creado: ${TESTS_FILE}.backup"

# Aplicar correcciones
for test in "${TESTS_TO_FIX[@]}"; do
    echo "üîÑ Corrigiendo $test..."
    
    # Buscar la l√≠nea del test y a√±adir ensureOracleActive() despu√©s
    sed -i "/function $test()/a\\        ensureOracleActive();" "$TESTS_FILE"
done

echo "üéØ Correcciones aplicadas exitosamente!"
echo "üìù Para revertir cambios: cp ${TESTS_FILE}.backup $TESTS_FILE"
